# Задание
## Работа с фаерволами в Linux
### 1. Введение в iptables и ufw
- Убедитесь, что на вашем Linux-дистрибутиве установлены iptables и ufw.
- Проверьте текущие правила фаервола, используя стандартные команды.
- Активируйте ufw и создайте базовое правило для разрешения подключения по SSH (порт 22). 
- Перезагрузите фаервол и убедитесь, что правило работает, выполнив подключение через SSH.

**Конечный результат**: Активированный фервол с настроенным правилом для SSH.

![[CleanShot 2025-07-24 at 20.04.32.png]]
### 2. Основные цепочки и таблицы в iptables
- Создайте новое правило в iptables для блокировки всех входящих подключений на определённый порт (например, порт 8080).
- Добавьте правило для разрешения подключений с конкретного IP-адреса (например, локального 127.0.0.1).
- Проверьте работу правил, используя команды тестирования соединений, такие как telnet или curl.

**Конечный результат**: Рабочие правила iptables, ограничивающие доступ к порту.
#### 1. Блокировка всех входящих подключений на порт 8080
```
sudo iptables -A INPUT -p tcp --dport 8080 -j DROP
```
#### 2. Разрешение подключений с конкретного IP-адреса (127.0.0.1)
```
sudo iptables -I INPUT 1 -p tcp -s 127.0.0.1 --dport 8080 -j ACCEPT
```
_Примечание: мы используем `-I INPUT 1` чтобы вставить правило в начало цепочки, перед правилом блокировки._
#### 3. Проверка текущих правил
```
sudo iptables -L INPUT -n --line-numbers
```
Вы должны увидеть что-то вроде:
```
Chain INPUT (policy ACCEPT)
num  target     prot opt source               destination
1    ACCEPT     tcp  --  127.0.0.1           0.0.0.0/0           tcp dpt:8080
2    DROP       tcp  --  0.0.0.0/0           0.0.0.0/0           tcp dpt:8080
```
#### 4. Проверка работы правил
Сначала проверьте доступ с разрешенного IP (если тестируете локально):
```
curl 127.0.0.1:8080
```
![[CleanShot 2025-07-24 at 21.04.34@2x.png]]
### 3. Современные альтернативы: nftables
- Установите nftables (если он отсутствует).
- Настройте базовые правила, аналогичные тем, что были созданы в iptables, но с использованием nftables.
- Проверьте функциональность и убедитесь, что доступ работает по настроенным правилам.

**Конечный результат**: Настроенный nftables с базовыми правилами безопасности.
#### **1. Установка nftables**
Если `nftables` не установлен, выполните:
### **Ubuntu/Debian:**
```
sudo apt update
sudo apt install nftables -y
sudo systemctl enable nftables
sudo systemctl start nftables
```
#### **2. Настройка правил (аналог iptables)**
##### **Создаем новый набор правил**
```
sudo nft flush ruleset  # Очистка текущих правил (если есть)
```
#### **Добавляем таблицу и цепочки**
```
sudo nft add table inet filter
sudo nft add chain inet filter input { type filter hook input priority 0 \; }
```
##### **Блокируем порт 8080 для всех, кроме localhost**
```
sudo nft add rule inet filter input tcp dport 8080 ip saddr 127.0.0.1 accept
sudo nft add rule inet filter input tcp dport 8080 drop
```
##### **Просмотр текущих правил**
```
sudo nft list ruleset
```
Вывод должен быть примерно таким:
```
table inet filter {
    chain input {
        type filter hook input priority 0;
        tcp dport 8080 ip saddr 127.0.0.1 accept
        tcp dport 8080 drop
    }
}
```
#### **3. Проверка работы**
##### **Разрешённый IP (127.0.0.1)**
```
curl 127.0.0.1:8080
```

![[CleanShot 2025-07-24 at 21.41.50@2x.png]]
## VPN: Принципы и настройка
### 1. Настройка WireGuard
- Установите WireGuard на вашем сервере и клиенте.
- Создайте ключи шифрования и настройте конфигурации для сервера и клиента.
- Настройте сервер для работы через публичный IP-адрес и создайте частную сеть, подключив клиента.
- Убедитесь, что клиент может пинговать сервер в приватной сети.

**Конечный результат**: Рабочая VPN-сеть на основе WireGuard, с пингом между клиентом и сервером.
### 2. OpenVPN: настройка и отличия
- Установите OpenVPN и создайте базовую конфигурацию для сервера.
- Настройте клиента для подключения к серверу.
- Проверьте, что трафик с клиента перенаправляется через VPN-сервер.

**Конечный результат**: Настроенный OpenVPN с проверкой маршрутизации трафика.

